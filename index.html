<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ray White Semarang Kota Pemasaran</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; flex-direction: column; align-items: center; padding: 50px; }
        canvas { border: 1px solid #000; margin-top: 20px; touch-action: none; }
        button { margin: 10px; padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>FORMULIR IJIN PEMASARAN YANG DI BUAT OLEH</h1>
    <h1>ENDRA (AGEN PROPERTI RAY WHITE SEMARANG KOTA)</h1>
    <img src="zazazaz.PNG" alt="Kartun Nama" style="max-width:600px; height:auto; margin-top:10px;"/>
    <img src="raywhite%20(p1).jpg" id="form-image" alt="Formulir" style="max-width:100%; height:auto; margin-top:20px;"/>
    <p>Gambar tanda tangan Anda di bawah ini:</p>
    <canvas id="signature-pad" width="500" height="200"></canvas>
    <div>
        <button id="clear">Hapus</button>
        <button id="save">Simpan tanda tangan</button>
    </div>

    <script>
        // Signature pad (desktop + mobile)
        const canvas = document.getElementById('signature-pad');
        const ctx = canvas.getContext('2d');
        let drawing = false;
        const getPos = e => {
            const rect = canvas.getBoundingClientRect();
            return {
                x: (e.touches ? e.touches[0].clientX : e.clientX) - rect.left,
                y: (e.touches ? e.touches[0].clientY : e.clientY) - rect.top
            };
        };
        const start = e => { e.preventDefault(); drawing = true; const pos = getPos(e); ctx.beginPath(); ctx.moveTo(pos.x, pos.y); };
        const move = e => { if(!drawing) return; e.preventDefault(); const pos = getPos(e); ctx.lineTo(pos.x, pos.y); ctx.strokeStyle='#000'; ctx.lineWidth=2; ctx.lineCap='round'; ctx.stroke(); };
        const end = e => { e.preventDefault(); drawing = false; };
        canvas.addEventListener('mousedown', start);
        canvas.addEventListener('mousemove', move);
        canvas.addEventListener('mouseup', end);
        canvas.addEventListener('mouseout', end);
        canvas.addEventListener('touchstart', start);
        canvas.addEventListener('touchmove', move);
        canvas.addEventListener('touchend', end);
        document.getElementById('clear').addEventListener('click', () => { ctx.clearRect(0,0,canvas.width,canvas.height); ctx.beginPath(); });

        // Prepare result canvas
        const resultCanvas = document.createElement('canvas');
        const resultCtx = resultCanvas.getContext('2d');
        resultCanvas.style.display = 'none';
        resultCanvas.style.marginTop = '20px';
        document.body.appendChild(resultCanvas);

        document.getElementById('save').addEventListener('click', () => {
            const dataURL = canvas.toDataURL('image/png');
            const sigImg = new Image(); sigImg.src = dataURL;
            sigImg.onload = () => {
                const formImg = document.getElementById('form-image');
                resultCanvas.width = formImg.naturalWidth;
                resultCanvas.height = formImg.naturalHeight;
                resultCtx.drawImage(formImg, 0, 0);
                const x = 115, y = formImg.naturalHeight - 240, w = 350, h = 120;
                resultCtx.drawImage(sigImg, x, y, w, h);
                resultCtx.font = "20px Arial";
                resultCtx.fillStyle = "#000";
                let name = prompt("Masukkan Nama Terang:") || "";
                resultCtx.fillText(name.toUpperCase(), x + 45, y + h + 5);
                resultCanvas.style.display = 'block';
                // otomatis download
                const link = document.createElement('a');
                link.download = 'form_hasil.png';
                link.href = resultCanvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
              <script>
window.onload = () => {
  // ... kode canvas sebelumnya ...

  document.getElementById('save').addEventListener('click', () => {
    // 1. merge form & signature ke resultCanvas (sudah ada)
    // 2. download otomatis (sudah ada)

    // 3. Kirim ke Google Apps Script
    fetch('https://script.google.com/macros/s/AKfycbwjw2AoyzLZM_bluxiZS7Atsol8phcroNrSQLXJ7HXALbF7CPMkxmlk8reZu-BOKfgE/exec', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        imageData: resultCanvas.toDataURL('image/png')
      })
    })
    .then(res => res.text())
    .then(() => alert('Email terkirim otomatis!'))
    .catch(err => alert('Gagal kirim email: ' + err));
  });
};

